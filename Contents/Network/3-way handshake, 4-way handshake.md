# 3-way handshake, 4-way handshake

---
## TCP ν†µμ‹ 
> TCP ν†µμ‹ μ€ μ•„λμ™€ κ°™μ€ **3λ‹¨κ³„μ κ³Όμ •**μ„ κ±°μΉλ‹¤.  

1. **Connection setup** (TCP μ—°κ²° μ΄κΈ°ν™”) - **3-way handshaking**  
2. **Data transfer** (λ°μ΄ν„° μ „μ†΅)  
3. **Connection termination** (TCP μ—°κ²° μΆ…λ£) - **4-way handshaking**  

---
## 3-way handshaking  
> TCP/IP ν”„λ΅ν† μ½μ—μ„ ν†µμ‹ μ„ μ‹μ‘ν•κΈ° μ „, _μ‹ λΆ°ν•  μ μλ” μ—°κ²°μ„ μ„¤μ •_ ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” κ³Όμ •μ΄λ‹¤.<br><br>
> μ΄ κ³Όμ •μ€ **ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ μ—°κ²°μ„ ν™•λ¦½**ν•λ” κ³Όμ •μΌλ΅, μ΄ **3λ‹¨κ³„(SYN β†’ SYN+ACK β†’ ACK)** λ΅ μ΄λ£¨μ–΄μ§„λ‹¤.

<img width="655" alt="image" src="https://github.com/user-attachments/assets/46949890-6226-4228-952b-f98d03ca307e" />

### β… κ³Όμ •
**1λ‹¨κ³„: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (SYN μ „μ†΅)**
  * **μ—°κ²° μ”μ²­** : _ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ μ”μ²­ν•κΈ° μ„ν•΄ SYN (Synchronize) ν¨ν‚·μ„ μ„λ²„λ΅_ λ³΄λ‚Έλ‹¤.
  * μ΄ ν¨ν‚·μ—λ” μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(Initial Sequence Number, ISN) κ°€ ν¬ν•¨λμ–΄ μλ‹¤.
  * μ„λ²„κ°€ μ΄ μ”μ²­μ„ μλ½ν•λ©΄ λ‹¤μ λ‹¨κ³„λ΅ μ§„ν–‰λλ‹¤.
<br>

**2λ‹¨κ³„: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (SYN + ACK μ‘λ‹µ)**
  * **μ—°κ²° μ”μ²­ μΉμΈ λ° μ„λ²„λ„ μ—°κ²° μ”μ²­** : μ„λ²„λ” μ‘λ‹µμΌλ΅ _SYN + ACK (Acknowledge) ν¨ν‚·μ„ ν΄λΌμ΄μ–ΈνΈμ—κ²_ λ³΄λ‚Έλ‹¤.
    * SYN: μ„λ²„λ„ ν΄λΌμ΄μ–ΈνΈμ™€μ μ—°κ²°μ„ μ”μ²­
    * ACK: ν΄λΌμ΄μ–ΈνΈμ SYN μ”μ²­μ„ μΉμΈ
  * μ΄λ•, μ„λ²„λ” μμ‹ μ μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)λ¥Ό ν¬ν•¨ν•λ‹¤.
<br>

**3λ‹¨κ³„: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (ACK μ „μ†΅)**
  * **μ—°κ²° ν™•λ¦½** : ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ SYN + ACK ν¨ν‚·μ„ μμ‹ ν• ν›„, _ACK (Acknowledgement) ν¨ν‚·μ„ λ‹¤μ‹ μ„λ²„λ΅_ λ³΄λ‚Έλ‹¤.
<br>

-> μ΄λ΅μ¨, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ μ—°κ²°μ΄ μ •μƒμ μΌλ΅ ν™•λ¦½λκ³ , μ΄ν›„ λ°μ΄ν„° μ „μ†΅μ΄ κ°€λ¥ν•΄μ§„λ‹¤. 

### λ©μ 
1. μ‹ λΆ°μ„± μλ” μ—°κ²° ν™•λ¦½: λ°μ΄ν„°λ¥Ό μ•μ •μ μΌλ΅ μ „μ†΅ν•κΈ° μ„ν• μ‚¬μ „ μ‘μ—…
2. μ–‘μΈ΅μ μ „μ†΅ μ¤€λΉ„ ν™•μΈ: ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ λ°μ΄ν„° μ†΅μμ‹ μ„ μ¤€λΉ„ν•  μ‹κ°„μ„ μ κ³µ
3. μ΄κΈ° μ‹ν€€μ¤ λ²νΈ κµν™: λ°μ΄ν„° μ „μ†΅μ μμ„λ¥Ό λ³΄μ¥ν•κΈ° μ„ν•΄ μ‹ν€€μ¤ λ²νΈ(ISN) μ„¤μ •

---

## 4-way handshaking  
> 4-way handshakeλ” TCP μ—°κ²° μΆ…λ£(Connection Termination) λ¥Ό μ„ν•΄ μ‚¬μ©ν•λ” κ³Όμ •μ΄λ‹¤. <br><br>
> TCPμ—μ„λ” μ–‘λ°©ν–¥(full-duplex) ν†µμ‹ μ„ μ κ³µν•κΈ° λ•λ¬Έμ—, μ—°κ²°μ„ λκΈ° μ„ν•΄μ„λ” μ–‘μ½ λ¨λ‘ μΆ…λ£ μ”μ²­μ„ λ³΄λ‚΄μ•Ό ν•λ”λ°, 
> μ΄ κ³Όμ •μ€ **FIN β†’ ACK β†’ FIN β†’ ACK** μ μ΄ 4λ‹¨κ³„λ΅ μ΄λ£¨μ–΄μ§„λ‹¤.

<img width="695" alt="image" src="https://github.com/user-attachments/assets/90191620-2a15-440f-8040-baa6c597593c" />
> TCP connection termination(μ—°κ²° μΆ…λ£)μ€ **μ–‘λ°©ν–¥μΌλ΅ 2κ°μ μ—°κ²°μ΄ λ…λ¦½μ μΌλ΅ λ‹¨κΈ°** λ•λ¬Έμ— **4λ‹¨κ³„**λ΅ μ§„ν–‰λλ‹¤.  


### β… κ³Όμ •
**1λ‹¨κ³„: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (FIN μ „μ†΅, μ—°κ²° μΆ…λ£ μ”μ²­)**
  * **ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²° μΆ…λ£ μ”μ²­** : _ν΄λΌμ΄μ–ΈνΈκ°€ λ” μ΄μƒ λ³΄λ‚Ό λ°μ΄ν„°κ°€ μ—†μ„ λ•, μ—°κ²° μΆ…λ£λ¥Ό μ”μ²­ν•κΈ° μ„ν•΄ FIN (Finish) ν¨ν‚·μ„ μ„λ²„λ΅_ λ³΄λ‚Έλ‹¤.
  * μ΄λ•, μ„λ²„λ” μ•„μ§ λ°μ΄ν„°λ¥Ό λ³΄λ‚Ό μλ„ μκΈ° λ•λ¬Έμ—, μ¦‰μ‹ μ—°κ²°μ„ λμ§€λ” μ•λ”λ‹¤.
  * μ„λ²„λ” FIN μ”μ²­μ„ μμ‹ ν• ν›„, μ‘λ‹µμ„ λ³΄λ‚Έλ‹¤.
<br>

**2λ‹¨κ³„: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (ACK μ „μ†΅, FIN μ”μ²­ μΉμΈ)**
  * **μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μΆ…λ£ μ”μ²­ μΉμΈ** : μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ FIN ν¨ν‚·μ„ λ°›μΌλ©΄, μ΄λ¥Ό _μΈμ •(ACK) ν•κ³  ACK (Acknowledgment) ν¨ν‚·μ„ ν΄λΌμ΄μ–ΈνΈμ—κ²_ λ³΄λ‚Έλ‹¤.
  * μ΄λ•, μ„λ²„λ” μ•„μ§ λ°μ΄ν„° μ „μ†΅μ„ μ™„λ£ν•μ§€ μ•μ•μ„ μλ„ μμΌλ―€λ΅ μ—°κ²°μ„ μ μ§€ν•λ‹¤.
    -> μ΄ κ²½μ°, ν΄λΌμ΄μ–ΈνΈλ” μ—°κ²°μ΄ μΆ…λ£λ κ²ƒμ΄ μ•„λ‹λΌ, μ„λ²„μ μ¶”κ°€ λ°μ΄ν„°κ°€ λ‚¨μ•„μλ” μƒνƒμ„μ„ μ•κ³  λ€κΈ°ν•λ‹¤.
<br>

**3λ‹¨κ³„: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (ACK μ „μ†΅, FIN μ”μ²­ μΉμΈ)**
  * **μ„λ²„λ„ μ—°κ²° μΆ…λ£ μ”μ²­** : μ„λ²„λ„ λ” μ΄μƒ λ³΄λ‚Ό λ°μ΄ν„°κ°€ μ—†μΌλ©΄ _ν΄λΌμ΄μ–ΈνΈμ—κ² FIN (Finish) ν¨ν‚·μ„ μ „μ†΅ν•μ—¬ μ—°κ²° μΆ…λ£λ¥Ό μ”μ²­_ν•λ‹¤.
<br>

**4λ‹¨κ³„: μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (ACK μ „μ†΅, FIN μ”μ²­ μΉμΈ)**
  * **ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ μΆ…λ£ μ”μ²­ μΉμΈ** : ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ FIN μ”μ²­μ„ μμ‹ ν• ν›„, μ΄λ¥Ό _μΉμΈν•λ” ACK (Acknowledgment) ν¨ν‚·μ„ μ„λ²„λ΅ μ „μ†΅_ν•λ‹¤.
<br>

-> μ΄ λ‹¨κ³„κ°€ λλ‚λ©΄ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„μ μ—°κ²°μ΄ μ™„μ „ν μΆ…λ£λλ‹¤.

## λ©μ 
1. λ°μ΄ν„° μ†μ‹¤ λ°©μ§€: μ„λ²„κ°€ μ•„μ§ μ „μ†΅ν•  λ°μ΄ν„°κ°€ λ‚¨μ•„ μμ„ μ μμΌλ―€λ΅, μ¦‰μ‹ μ—°κ²°μ„ λμ§€ μ•κ³  λ°μ΄ν„° μ „μ†΅μ„ λ§μΉ  μ‹κ°„μ„ μ¤
2. μ–‘λ°©ν–¥ μ—°κ²° μΆ…λ£ λ³΄μ¥: ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ κ°μμ μΆ…λ£ μ”μ²­μ„ λ”°λ΅ μ²λ¦¬ν•μ—¬ μ•μ „ν•κ² μ—°κ²°μ„ μΆ…λ£

---

### π’΅λ©΄μ ‘ λ€λΉ„ ν•µμ‹¬ ν¬μΈνΈπ’΅
## 1. 3-way handshakeλ¥Ό ν•λ” λ©μ 
## 2. κ° stepμ μ μ°¨
β… 3-way Handshake 
| λ‹¨κ³„  | μ†΅μ‹ μ  | μμ‹ μ  | ν¨ν‚· μΆ…λ¥  | μ„¤λ… |
|------|------|------|------|------|
| 1λ‹¨κ³„ | ν΄λΌμ΄μ–ΈνΈ | μ„λ²„ | SYN | μ—°κ²° μ”μ²­ |
| 2λ‹¨κ³„ | μ„λ²„ | ν΄λΌμ΄μ–ΈνΈ | SYN + ACK | μ—°κ²° μ”μ²­ μΉμΈ λ° μ„λ²„λ„ μ—°κ²° μ”μ²­ |
| 3λ‹¨κ³„ | ν΄λΌμ΄μ–ΈνΈ | μ„λ²„ | ACK | μ—°κ²° ν™•λ¦½ μ™„λ£ |

<br>

β… 4-way Handshake
| λ‹¨κ³„  | μ†΅μ‹ μ  | μμ‹ μ  | ν¨ν‚· μΆ…λ¥  | μ„¤λ… |
|------|------|------|------|------|
| 1λ‹¨κ³„ | ν΄λΌμ΄μ–ΈνΈ | μ„λ²„ | FIN | ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²° μΆ…λ£ μ”μ²­ |
| 2λ‹¨κ³„ | μ„λ²„ | ν΄λΌμ΄μ–ΈνΈ | ACK | μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μΆ…λ£ μ”μ²­ μΉμΈ |
| 3λ‹¨κ³„ | μ„λ²„ | ν΄λΌμ΄μ–ΈνΈ | FIN | μ„λ²„λ„ μ—°κ²° μΆ…λ£ μ”μ²­ |
| 4λ‹¨κ³„ | ν΄λΌμ΄μ–ΈνΈ | μ„λ²„ | ACK | ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ μΆ…λ£ μ”μ²­ μΉμΈ |
